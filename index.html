<script>
function fmt(n) {
  return n.toLocaleString("nl-NL", { minimumFractionDigits: 2, maximumFractionDigits: 2 });
}

function calc() {

  let urenPM   = Number(document.getElementById("urenPM").value);
  let tarief   = Number(document.getElementById("tarief").value);
  let opleiding= Number(document.getElementById("opleiding").value); // negatief = kosten
  let lease    = Number(document.getElementById("lease").value);     // negatief = kosten
  let laad     = Number(document.getElementById("laad").value);      // negatief = kosten
  let telefoon = Number(document.getElementById("telefoon").value);  // negatief = kosten
  let vast     = Number(document.getElementById("vast").value);

  // Omzet
  let omzetPM = urenPM * tarief;
  let omzetPJ = omzetPM * 12;

  // Kantoorkosten: altijd 30% van jaaromzet, met absoluut maximum 61.276
  let kantoorPJ = Math.min(0.30 * omzetPJ, 61276);
  let kantoorPM = kantoorPJ / 12;

  // Werkgeverslasten (WGL)
  const WGL_RATE = 0.39;
  const WGL_CAP  = 79412; // (pas dit aan als jullie echt 79.409 willen hanteren)

  // Overige maandelijkse kosten (opleiding/lease/laad/telefoon zijn negatief ingevuld)
  // Deze zijn kosten, dus moeten de ruimte voor salaris verlagen vóór de WGL/variabel berekening.
  const overigeKostenPM = -(opleiding + lease + laad + telefoon); // positief bedrag als er kosten zijn

  // Netto "ruimte" per maand na kosten (omzet minus kantoorkosten minus overige kosten)
  const R = omzetPM - kantoorPM - overigeKostenPM;

  const Fs = vast;

  // Variabel oplossen onder de aanname: R = Fs + variabel + WGL_RATE*(Fs+variabel)
  // => variabel = (R - Fs*(1+WGL_RATE)) / (1+WGL_RATE)
  let variabel = 0;
  let wglPM = 0;

  let v1 = (R - Fs * (1 + WGL_RATE)) / (1 + WGL_RATE);

  if (v1 <= 0) {
    variabel = 0;
    // WGL over salaris (max tot cap)
    wglPM = WGL_RATE * Math.min(WGL_CAP / 12, Fs);
  } else {
    let jaarink = 12 * (Fs + v1);

    if (jaarink <= WGL_CAP) {
      variabel = v1;
      wglPM = WGL_RATE * (Fs + v1);
    } else {
      // Cap bereikt: WGL is maximaal per maand
      let wglCapPM = (WGL_CAP / 12) * WGL_RATE;

      variabel = R - Fs - wglCapPM;
      if (variabel < 0) variabel = 0;

      wglPM = wglCapPM;
    }
  }

  // Vakantiegeldreservering (zoals jij 'm had: 8% alleen over vast)
  let vakRes = Fs * 0.08;

  // Totaal bruto per maand (vast + variabel)
  let totaalPM = Fs + variabel;

  document.getElementById("result").innerHTML = `
    <table>
      <tr><td class="label-column">Omzet per maand:</td><td class="value-column">€ ${fmt(omzetPM)}</td></tr>
      <tr><td class="label-column">Kantoorkosten per maand:</td><td class="value-column">€ ${fmt(kantoorPM)}</td></tr>
      <tr><td class="label-column">Overige kosten per maand (lease/opl./laad/tel.):</td><td class="value-column">€ ${fmt(overigeKostenPM)}</td></tr>


